---
- tags: all
  include_vars: setup-vars.yml


- name: Ajoute toutes les clefs ssh de la FSD
  ansible.builtin.shell:
    cmd: curl https://raw.githubusercontent.com/zuzu59/deploy-proxmox/master/get_ssh_key_fsd.sh | bash
    chdir: /home/ubuntu
  tags: [ never, init_ssh ]


- name: install useful packages
  apt:
    name:
      - unixodbc
      - unixodbc-dev
      - freetds-dev
      - tdsodbc
    state: present
    force_apt_get: yes
  become: yes
  tags:
    - install_packages


- name: Docker install
  import_tasks:
    file: docker-install.yml
  tags:
    - docker-install


- name: Création du dossier /app/ofrf
  ansible.builtin.file:
    path: "/app/ofrf"
    state: directory
    owner: ubuntu
    group: ubuntu
    mode: '0755'
  become: yes


- name: Clone bill2myprint repo
  git:
      repo: git@github.com:epfl-si/bill2myprint.git
      dest: /app/ofrf
      force: yes
      version: fea-docker-file


- name: app server install
  import_tasks:
    file: app-server.yml
  tags:
    - app-server-install


- name: db server install
  import_tasks:
    file: db-server.yml
  tags:
    - db-server-install


#- name: Copie le fichier toto.txt
#  ansible.builtin.copy:
#    src: ./toto.txt
#    dest: /home/ubuntu
#    owner: ubuntu
#    group: ubuntu
#    mode: '0644'
#
#
#- name: Création du dossier toto-dir
#  ansible.builtin.file:
#    path: "{{ toto_dir }}"
#    state: directory
#    mode: '0755'
#
#
#- name: Création du dossier tutu-dir
#  ansible.builtin.file:
#    path: "{{ tutu_dir }}"
#    state: directory
#    mode: '0755'
#
#
#- name: Docker install
#  import_tasks:
#    file: docker-install.yml
#  tags:
#    - docker-install
#
#
#- name: WEB server install
#  import_tasks:
#    file: web-server.yml
#  tags:
#    - web-server-install







